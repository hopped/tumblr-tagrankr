/*!
 * tumblr.TagRankr - jQuery UI Widget
 * version: 1.0 (30th May 2013)
 * @requires jQuery UI v1.9 or later
 * Licenced under the MIT License
 * Copyright (c) 2013 Dennis Hoppe (github.com/hopped)
 */
(function(a){a.widget("hopped.tagRankr",{options:{api_key:undefined,blog:undefined,callback:undefined,defaults:{sorting:"frequency",prefix:"",show_count:"true"}},vars:{base_url:"http://api.tumblr.com/v2/blog",tagrankr_id:"tagRankr-list"},version:"1.0",_create:function(){var b=this.element,c=this.options;a("<ul></ul>").attr("id",this.vars.tagrankr_id).appendTo(b);if(this._validateOptions(c)){c.blog=c.blog.replace(/^http:\/\//,"");this._process(c)}},_validateOptions:function(b){if(b.api_key===undefined){console.error("Tumblr API key is missing.");this._handleError();return false}if(b.blog===undefined){console.error("The parameter 'blog' is missing.");this._handleError();return false}if(b.defaults.sorting!=="frequency"&&b.defaults.sorting!=="alphabetically"){console.error("The parameter 'sorting' is invalid (frequency or alphabetically).");this._handleError();return false}b.defaults.show_count=b.defaults.show_count.toLowerCase();if(b.defaults.show_count!=="true"&&b.defaults.show_count!=="false"){console.error("The parameter 'show_count' is invalid (true or false).");this._handleError();return false}return true},_process:function(d){var c=this,b=c.vars.base_url+"/"+d.blog+"/posts?api_key="+d.api_key+"&callback=?";a.getJSON(b,{format:"json"}).done(function(e,f){if(f==="success"&&e.meta.status===200){c._addTags(e,"#"+c.vars.tagrankr_id,d);if(c.options.callback!==undefined){c.options.callback()}return}c._handleError(e.meta,b,d)})},_addTags:function(c,b,d){var e={};a.each(c.response.posts,function(f,g){a.each(g.tags,function(i,h){var k=e[h]||0;k+=1;e[h]=k})});if(this.options.defaults.sorting==="alphabetically"){this._sortAlphabetically(b,d,e)}else{this._sortByFrequency(b,d,e)}},_sortByFrequency:function(b,d,e){var c=this;Object.keys(e).sort(function(g,f){return e[f]-e[g]}).forEach(function(f){c._addListElement(b,d,f,e[f])})},_sortAlphabetically:function(b,d,e){var c=this;Object.keys(e).sort(function(g,f){return g.toLowerCase().localeCompare(f.toLowerCase())}).forEach(function(f){c._addListElement(b,d,f,e[f])})},_addListElement:function(d,f,c,e){var b=this.options.defaults.prefix+c;if(this.options.defaults.show_count!=="false"){b=b+" ("+e+")"}a("<a></a>",{href:"http://"+f.blog+"/tagged/"+c,text:b}).appendTo(d).wrap("<li></li>")},_handleError:function(c,b,d){console.log(this.vars.tagrankr_id);a("<li></li>").text("Sorry, tag list could not be retrieved (cf. console)").appendTo("#"+this.vars.tagrankr_id);if(c===undefined){return}switch(c.status){case 401:console.error("Failed request: %s. Is your Tumblr API key valid? %s",c.msg,d.api_key);break;case 404:console.error("Failed request: %s. Is this your blog? %s",c.msg,d.blog);break;default:console.error("Failed request: %s, Status: %s, Message: %s",b,c.status,c.msg);break}},_destroy:function(){return this._super()}})}(jQuery));